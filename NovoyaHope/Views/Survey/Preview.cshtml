@model NovoyaHope.Models.ViewModels.PassSurveyViewModel
@using NovoyaHope.Models

@{
    // –£–¥–∞–ª—è–µ–º HTML —Ç–µ–≥–∏ –∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ title —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    ViewData["Title"] = "–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä: " + System.Text.RegularExpressions.Regex.Replace(Model.Title ?? "", "<.*?>", "").Trim();
    Layout = null; // –ë–µ–∑ layout –¥–ª—è —á–∏—Å—Ç–æ–≥–æ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞
}

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"]</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: '@(Model.TextFontFamily ?? "Roboto")', sans-serif;
            background: @(Model.BackgroundColor ?? "#F3E5F5");
            min-height: 100vh;
            padding-bottom: 50px;
        }

        .preview-header {
            background: white;
            padding: 16px 24px;
            border-bottom: 1px solid #dadce0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .preview-header-left {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .preview-back-btn {
            background: none;
            border: none;
            color: #5f6368;
            cursor: pointer;
            font-size: 1.2rem;
            padding: 8px;
            border-radius: 50%;
            transition: background-color 0.2s;
        }

        .preview-back-btn:hover {
            background-color: #f1f3f4;
        }

        .preview-header-title {
            font-size: 0.875rem;
            color: #5f6368;
            font-weight: 500;
        }

        .preview-header-right {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .preview-notice {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 12px 16px;
            margin: 0 24px;
            margin-top: 16px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .preview-notice i {
            color: #ff9800;
            font-size: 1.2rem;
        }

        .preview-notice-text {
            color: #856404;
            font-size: 0.875rem;
        }

        .preview-container {
            max-width: 640px;
            margin: 0 auto;
            padding-top: 15px;
        }

        .preview-header-card, .preview-question-card {
            background: white;
            border: 1px solid #dadce0;
            border-radius: 8px;
            padding: 24px;
            margin-bottom: 12px;
        }

        .preview-header-card {
            border-top: 10px solid @(Model.ThemeColor ?? "#673AB7");
            @if (!string.IsNullOrEmpty(Model.HeaderImagePath))
            {
                <text>
                background-image: url('@Model.HeaderImagePath');
                background-size: cover;
                background-position: center;
                background-repeat: no-repeat;
                </text>
            }
        }

        .preview-title {
            font-size: @(Model.HeaderFontSize ?? 24)pt;
            font-family: '@(Model.HeaderFontFamily ?? "Courier New")', monospace;
            font-weight: 400;
            margin-bottom: 10px;
            color: #202124;
        }

        .preview-description {
            font-size: @(Model.TextFontSize ?? 11)pt;
            font-family: '@(Model.TextFontFamily ?? "Roboto")', sans-serif;
            color: #202124;
            margin-bottom: 10px;
            line-height: 1.6;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ –∏ –æ–ø–∏—Å–∞–Ω–∏–∏ */
        .preview-title strong,
        .preview-description strong {
            font-weight: 600;
        }

        .preview-title em,
        .preview-description em {
            font-style: italic;
        }

        .preview-title u,
        .preview-description u {
            text-decoration: underline;
        }

        .preview-title a,
        .preview-description a {
            color: @(Model.ThemeColor ?? "#673AB7");
            text-decoration: underline;
        }

        .preview-title a:hover,
        .preview-description a:hover {
            opacity: 0.8;
        }

        .preview-title ul,
        .preview-description ul,
        .preview-title ol,
        .preview-description ol {
            margin: 10px 0;
            padding-left: 30px;
        }

        .preview-title li,
        .preview-description li {
            margin: 5px 0;
        }

        .preview-divider {
            margin: 15px 0;
            border: 0;
            border-top: 1px solid #dadce0;
        }

        .preview-question-text {
            font-size: @(Model.QuestionFontSize ?? 12)px;
            font-family: '@(Model.QuestionFontFamily ?? "Roboto")', sans-serif;
            color: #202124;
            margin-bottom: 20px;
            font-weight: 500;
        }

        .preview-option {
            display: flex;
            align-items: center;
            padding: 8px 0;
        }

        .preview-option input {
            margin-right: 15px;
            accent-color: @(Model.ThemeColor ?? "#673AB7");
            width: 18px;
            height: 18px;
        }

        .preview-option-text {
            font-size: @(Model.TextFontSize ?? 11)px;
            font-family: '@(Model.TextFontFamily ?? "Roboto")', sans-serif;
            color: #202124;
        }

        .preview-input {
            width: 100%;
            border: none;
            border-bottom: 1px solid #dadce0;
            padding: 5px 0;
            font-size: @(Model.TextFontSize ?? 11)px;
            font-family: '@(Model.TextFontFamily ?? "Roboto")', sans-serif;
            outline: none;
            transition: border-bottom 0.3s;
        }

        .preview-input:focus {
            border-bottom: 2px solid @(Model.ThemeColor ?? "#673AB7");
        }

        .preview-footer {
            text-align: center;
            font-size: 12px;
            color: #5f6368;
            margin-top: 20px;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤ —Ä–∞–∑–¥–µ–ª–∞—Ö */
        .preview-section-title,
        .preview-section-description {
            line-height: 1.6;
        }

        .preview-section-title strong,
        .preview-section-description strong {
            font-weight: 600;
        }

        .preview-section-title em,
        .preview-section-description em {
            font-style: italic;
        }

        .preview-section-title u,
        .preview-section-description u {
            text-decoration: underline;
        }

        .preview-section-title a,
        .preview-section-description a {
            color: @(Model.ThemeColor ?? "#673AB7");
            text-decoration: underline;
        }

        .preview-section-title ul,
        .preview-section-description ul,
        .preview-section-title ol,
        .preview-section-description ol {
            margin: 10px 0;
            padding-left: 30px;
        }

        .preview-section-title li,
        .preview-section-description li {
            margin: 5px 0;
        }
    </style>
</head>
<body>
    <div class="preview-header">
        <div class="preview-header-left">
            <button type="button" class="preview-back-btn" onclick="window.close()" title="–ó–∞–∫—Ä—ã—Ç—å –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä">
                <i class="fas fa-arrow-left"></i>
            </button>
            <span class="preview-header-title">–†–µ–∂–∏–º –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞</span>
        </div>
        <div class="preview-header-right">
            <span style="color: #5f6368; font-size: 0.875rem;">–§–æ—Ä–º–∞ –Ω–µ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–∞</span>
        </div>
    </div>

    <div class="preview-notice">
        <i class="fas fa-exclamation-triangle"></i>
        <span class="preview-notice-text">–í —ç—Ç–æ–π —Ñ–æ—Ä–º–µ –Ω–µ –ø—Ä–∏–Ω–∏–º–∞—é—Ç—Å—è –æ—Ç–≤–µ—Ç—ã.</span>
    </div>

    <div class="preview-container">
        <div class="preview-header-card">
            <h1 class="preview-title">@Html.Raw(Model.Title ?? "")</h1>
            @if (!string.IsNullOrWhiteSpace(Model.Description))
            {
                <div class="preview-description">@Html.Raw(Model.Description)</div>
            }
            <hr class="preview-divider" />
            <div style="font-size: 0.9rem; color: #5f6368;">
                <small>üîí –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Ñ–æ—Ä–º—ã</small>
                <div style="margin-top: 8px; color: #d93025;">* –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –≤–æ–ø—Ä–æ—Å</div>
            </div>
        </div>

        @{
            // –°–æ–∑–¥–∞–µ–º –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Å –∏—Ö –ø–æ—Ä—è–¥–∫–æ–º
            var allElements = new List<dynamic>();
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Ä–∞–∑–¥–µ–ª—ã
            if (Model.Sections != null)
            {
                foreach (var sectionItem in Model.Sections.OrderBy(s => s.Order))
                {
                    allElements.Add(new { Type = "Section", Order = sectionItem.Order, Data = sectionItem });
                }
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –º–µ–¥–∏–∞
            if (Model.Media != null)
            {
                foreach (var mediaItem in Model.Media.OrderBy(m => m.Order))
                {
                    allElements.Add(new { Type = "Media", Order = mediaItem.Order, Data = mediaItem });
                }
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –≤–æ–ø—Ä–æ—Å—ã
            if (Model.Questions != null)
            {
                foreach (var question in Model.Questions.OrderBy(q => q.Order))
                {
                    allElements.Add(new { Type = "Question", Order = question.Order, Data = question });
                }
            }
            
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –ø–æ—Ä—è–¥–∫—É
            allElements = allElements.OrderBy(e => e.Order).ToList();
        }

        @foreach (var element in allElements)
        {
            if (element.Type == "Section")
            {
                var sectionItem = (Section)element.Data;
                <div class="preview-question-card" style="border-left: 4px solid @(Model.ThemeColor ?? "#673AB7");">
                    <h2 class="preview-section-title" style="font-size: 20px; font-weight: 600; color: #202124; margin-bottom: 10px;">@Html.Raw(string.IsNullOrWhiteSpace(sectionItem.Title) ? "(–†–∞–∑–¥–µ–ª –±–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è)" : sectionItem.Title)</h2>
                    @if (!string.IsNullOrWhiteSpace(sectionItem.Description))
                    {
                        <div class="preview-section-description" style="font-size: 14px; color: #5f6368; line-height: 1.6; margin: 0;">@Html.Raw(sectionItem.Description)</div>
                    }
                </div>
            }
            else if (element.Type == "Media")
            {
                var mediaItem = (Media)element.Data;
                <div class="preview-question-card">
                    @if (!string.IsNullOrWhiteSpace(mediaItem.Title))
                    {
                        <h3 style="font-size: 18px; font-weight: 600; color: #202124; margin-bottom: 15px;">@mediaItem.Title</h3>
                    }
                    @if (mediaItem.Type == MediaType.Image && !string.IsNullOrWhiteSpace(mediaItem.Url))
                    {
                        <div style="margin: 15px 0; text-align: center;">
                            <img src="@mediaItem.Url" alt="@mediaItem.Title" style="max-width: 100%; height: auto; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);" />
                        </div>
                    }
                    else if (mediaItem.Type == MediaType.Video && !string.IsNullOrWhiteSpace(mediaItem.Url))
                    {
                        <div style="margin: 15px 0; position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
                            @if (mediaItem.Url.Contains("youtube.com") || mediaItem.Url.Contains("youtu.be"))
                            {
                                var videoId = "";
                                if (mediaItem.Url.Contains("youtube.com/watch?v="))
                                {
                                    videoId = mediaItem.Url.Split(new[] { "v=" }, StringSplitOptions.None)[1].Split('&')[0];
                                }
                                else if (mediaItem.Url.Contains("youtu.be/"))
                                {
                                    videoId = mediaItem.Url.Split(new[] { "youtu.be/" }, StringSplitOptions.None)[1].Split('?')[0];
                                }
                                
                                if (!string.IsNullOrEmpty(videoId))
                                {
                                    <iframe style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border-radius: 8px;" 
                                            src="https://www.youtube.com/embed/@videoId" 
                                            frameborder="0" 
                                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                                            allowfullscreen></iframe>
                                }
                                else
                                {
                                    <a href="@mediaItem.Url" target="_blank" style="display: inline-block; padding: 12px 24px; background-color: @(Model.ThemeColor ?? "#673AB7"); color: white; text-decoration: none; border-radius: 8px; font-weight: 500;">–û—Ç–∫—Ä—ã—Ç—å –≤–∏–¥–µ–æ</a>
                                }
                            }
                            else
                            {
                                <video controls style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border-radius: 8px;">
                                    <source src="@mediaItem.Url" type="video/mp4">
                                    –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤–∏–¥–µ–æ.
                                </video>
                            }
                        </div>
                    }
                    @if (!string.IsNullOrWhiteSpace(mediaItem.Description))
                    {
                        <p style="font-size: 14px; color: #5f6368; line-height: 1.6; margin-top: 15px; margin-bottom: 0;">@mediaItem.Description</p>
                    }
                </div>
            }
            else if (element.Type == "Question")
            {
                var question = (PassQuestionViewModel)element.Data;
                <div class="preview-question-card">
                    <div class="preview-question-text">
                        @(string.IsNullOrWhiteSpace(question.Text) ? "(–í–æ–ø—Ä–æ—Å –±–µ–∑ —Ç–µ–∫—Å—Ç–∞)" : question.Text)
                        @if (question.IsRequired)
                        {
                            <span style="color: #d93025;">*</span>
                        }
                    </div>

                    <div class="preview-answer-area">
                        @switch (question.Type)
                        {
                        case QuestionType.ShortText:
                            <input type="text" class="preview-input" placeholder="–ö—Ä–∞—Ç–∫–∏–π –æ—Ç–≤–µ—Ç" disabled>
                            break;

                        case QuestionType.ParagraphText:
                            <textarea class="preview-input" placeholder="–†–∞–∑–≤–µ—Ä–Ω—É—Ç—ã–π –æ—Ç–≤–µ—Ç" rows="4" disabled></textarea>
                            break;

                        case QuestionType.SingleChoice:
                            @if (question.Options != null)
                            {
                                @foreach (var option in question.Options)
                                {
                                    <label class="preview-option">
                                        <input type="radio" disabled>
                                        <span class="preview-option-text">@(string.IsNullOrWhiteSpace(option.Text) ? "(–ü—É—Å—Ç–æ–π –≤–∞—Ä–∏–∞–Ω—Ç)" : option.Text)</span>
                                    </label>
                                }
                            }
                            break;

                        case QuestionType.MultipleChoice:
                            @if (question.Options != null)
                            {
                                @foreach (var option in question.Options)
                                {
                                    <label class="preview-option">
                                        <input type="checkbox" disabled>
                                        <span class="preview-option-text">@(string.IsNullOrWhiteSpace(option.Text) ? "(–ü—É—Å—Ç–æ–π –≤–∞—Ä–∏–∞–Ω—Ç)" : option.Text)</span>
                                    </label>
                                }
                            }
                            break;

                        case QuestionType.Dropdown:
                            <select class="preview-input" style="max-width: 300px; padding: 10px 12px; border: 1px solid #dadce0; border-radius: 4px;" disabled>
                                <option>–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç</option>
                                @if (question.Options != null)
                                {
                                    @foreach (var option in question.Options)
                                    {
                                        <option>@(string.IsNullOrWhiteSpace(option.Text) ? "(–ü—É—Å—Ç–æ–π –≤–∞—Ä–∏–∞–Ω—Ç)" : option.Text)</option>
                                    }
                                }
                            </select>
                            break;

                        case QuestionType.Scale:
                            <div style="display: flex; justify-content: space-between; max-width: 300px; margin: 10px 0;">
                                @for (int i = 1; i <= 5; i++)
                                {
                                    <label style="display: flex; flex-direction: column; align-items: center; cursor: pointer;">
                                        <span style="margin-bottom: 10px; font-size: 14px;">@i</span>
                                        <input type="radio" disabled style="accent-color: @(Model.ThemeColor ?? "#673AB7");">
                                    </label>
                                }
                            </div>
                            break;

                        case QuestionType.Rating:
                            <div style="display: flex; gap: 8px; margin: 10px 0;">
                                @for (int i = 1; i <= 5; i++)
                                {
                                    <span style="font-size: 2rem; opacity: 0.5;">‚≠ê</span>
                                }
                            </div>
                            break;

                        case QuestionType.Date:
                            <input type="date" class="preview-input" style="max-width: 250px; padding: 8px 12px; border: 1px solid #dadce0; border-radius: 4px;" disabled>
                            break;

                        case QuestionType.Time:
                            <input type="time" class="preview-input" style="max-width: 250px; padding: 8px 12px; border: 1px solid #dadce0; border-radius: 4px;" disabled>
                            break;

                        case QuestionType.FileUpload:
                            <div style="padding: 40px 20px; border: 2px dashed #dadce0; border-radius: 8px; text-align: center; background-color: #fafafa; color: #5f6368;">
                                <i class="fas fa-cloud-upload-alt" style="font-size: 2.5rem; margin-bottom: 10px; display: block;"></i>
                                <span>–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞</span>
                            </div>
                            break;

                        case QuestionType.CheckboxGrid:
                            @if (question.Options != null)
                            {
                                <div style="display: flex; flex-direction: column; gap: 10px;">
                                    @foreach (var option in question.Options.OrderBy(o => o.Order))
                                    {
                                        <label class="preview-option">
                                            <input type="checkbox" disabled>
                                            <span class="preview-option-text">@(string.IsNullOrWhiteSpace(option.Text) ? "(–ü—É—Å—Ç–æ–π –≤–∞—Ä–∏–∞–Ω—Ç)" : option.Text)</span>
                                        </label>
                                    }
                                </div>
                            }
                            break;

                        case QuestionType.RadioGrid:
                            @if (question.Options != null)
                            {
                                <div style="display: flex; flex-direction: column; gap: 10px;">
                                    @foreach (var option in question.Options.OrderBy(o => o.Order))
                                    {
                                        <label class="preview-option">
                                            <input type="radio" disabled>
                                            <span class="preview-option-text">@(string.IsNullOrWhiteSpace(option.Text) ? "(–ü—É—Å—Ç–æ–π –≤–∞—Ä–∏–∞–Ω—Ç)" : option.Text)</span>
                                        </label>
                                    }
                                </div>
                            }
                            break;
                        }
                    </div>
                </div>
            }
        }

        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 10px;">
            <button type="button" style="background-color: @(Model.ThemeColor ?? "#673AB7"); color: white; border: none; border-radius: 8px; padding: 12px 32px; font-size: 15px; font-weight: 600; cursor: not-allowed; opacity: 0.6;" disabled>
                –û—Ç–ø—Ä–∞–≤–∏—Ç—å
            </button>
            <div style="color: @(Model.ThemeColor ?? "#673AB7"); font-size: 14px; cursor: pointer; font-weight: 500;">
                –û—á–∏—Å—Ç–∏—Ç—å —Ñ–æ—Ä–º—É
            </div>
        </div>
    </div>

    <div class="preview-footer">
        –°–æ–∑–¥–∞–Ω–æ —Å –ø–æ–º–æ—â—å—é <b>Poles Forms</b>
    </div>
</body>
</html>

